Args in experiment:
Namespace(H_order=10, ab=2, activation='gelu', aug_data_size=1, aug_method='NA', aug_rate=0.5, base_T=144, batch_size=64, c_out=7, checkpoints='./checkpoints/', cut_freq=70, d_ff=2048, d_layers=1, d_model=512, data='custom', data_path='weather.csv', data_size=1, dec_in=7, des='Exp', devices='0,1,2,3', distil=True, do_predict=False, dropout=0.05, e_layers=2, embed='timeF', embed_type=0, enc_in=21, factor=1, features='M', freq='h', gpu=3, groups=1, hidden_size=1, in_batch_augmentation=False, in_dataset_augmentation=False, individual=True, is_training=1, itr=1, kernel=5, label_len=48, learning_rate=0.0005, levels=3, loss='mse', lradj='type3', model='FITS', model_id='Weather_720_j96_H10', moving_avg=25, n_heads=8, num_workers=10, output_attention=False, patience=3, pred_len=96, root_path='./dataset/', seed=2021, seq_len=720, stacks=1, target='OT', test_flop=False, test_time_train=False, testset_div=2, train_epochs=50, train_mode=1, use_amp=False, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:3
>>>>>>>start training : Weather_720_j96_H10_FITS_custom_ftM_sl720_ll48_pl96_H10_0>>>>>>>>>>>>>>>>>>>>>>>>>>
train 36072
val 5175
test 10444
Model(
  (freq_upsampler): ModuleList(
    (0): Linear(in_features=70, out_features=79, bias=True)
    (1): Linear(in_features=70, out_features=79, bias=True)
    (2): Linear(in_features=70, out_features=79, bias=True)
    (3): Linear(in_features=70, out_features=79, bias=True)
    (4): Linear(in_features=70, out_features=79, bias=True)
    (5): Linear(in_features=70, out_features=79, bias=True)
    (6): Linear(in_features=70, out_features=79, bias=True)
    (7): Linear(in_features=70, out_features=79, bias=True)
    (8): Linear(in_features=70, out_features=79, bias=True)
    (9): Linear(in_features=70, out_features=79, bias=True)
    (10): Linear(in_features=70, out_features=79, bias=True)
    (11): Linear(in_features=70, out_features=79, bias=True)
    (12): Linear(in_features=70, out_features=79, bias=True)
    (13): Linear(in_features=70, out_features=79, bias=True)
    (14): Linear(in_features=70, out_features=79, bias=True)
    (15): Linear(in_features=70, out_features=79, bias=True)
    (16): Linear(in_features=70, out_features=79, bias=True)
    (17): Linear(in_features=70, out_features=79, bias=True)
    (18): Linear(in_features=70, out_features=79, bias=True)
    (19): Linear(in_features=70, out_features=79, bias=True)
    (20): Linear(in_features=70, out_features=79, bias=True)
  )
)
[INFO] Register count_linear() for <class 'torch.nn.modules.linear.Linear'>.
FLOPs:  7432320.0
params:  117789.0
Trainable parameters:  117789
!!!!!!!!!!!!!!learning rate!!!!!!!!!!!!!!!
0.0005
	iters: 100, epoch: 1 | loss: 0.3857940
	speed: 0.2243s/iter; left time: 6292.8168s
	iters: 200, epoch: 1 | loss: 0.2497279
	speed: 0.2011s/iter; left time: 5620.1720s
	iters: 300, epoch: 1 | loss: 0.3722351
	speed: 0.1794s/iter; left time: 4997.7471s
	iters: 400, epoch: 1 | loss: 0.7750619
	speed: 0.2185s/iter; left time: 6063.9600s
	iters: 500, epoch: 1 | loss: 0.2350228
	speed: 0.2190s/iter; left time: 6055.3380s
Epoch: 1 cost time: 118.20747184753418
Epoch: 1, Steps: 563 | Train Loss: 0.4604535 Vali Loss: 0.4024083 Test Loss: 0.1569473
Validation loss decreased (inf --> 0.402408).  Saving model ...
Updating learning rate to 0.0005
	iters: 100, epoch: 2 | loss: 0.3051917
	speed: 1.0395s/iter; left time: 28573.7536s
	iters: 200, epoch: 2 | loss: 0.3898535
	speed: 0.2176s/iter; left time: 5959.0371s
	iters: 300, epoch: 2 | loss: 0.2422494
	speed: 0.2099s/iter; left time: 5728.8410s
	iters: 400, epoch: 2 | loss: 0.3742141
	speed: 0.2125s/iter; left time: 5778.5079s
	iters: 500, epoch: 2 | loss: 0.3309532
	speed: 0.2075s/iter; left time: 5620.8496s
Epoch: 2 cost time: 120.06314969062805
Epoch: 2, Steps: 563 | Train Loss: 0.4006773 Vali Loss: 0.3899785 Test Loss: 0.1494492
Validation loss decreased (0.402408 --> 0.389978).  Saving model ...
Updating learning rate to 0.000475
	iters: 100, epoch: 3 | loss: 0.2776866
	speed: 1.2041s/iter; left time: 32421.4529s
	iters: 200, epoch: 3 | loss: 0.4620005
	speed: 0.2184s/iter; left time: 5857.5039s
	iters: 300, epoch: 3 | loss: 0.2399482
	speed: 0.1734s/iter; left time: 4634.5510s
	iters: 400, epoch: 3 | loss: 0.8515511
	speed: 0.1949s/iter; left time: 5189.1413s
	iters: 500, epoch: 3 | loss: 0.3062420
	speed: 0.2120s/iter; left time: 5622.1125s
Epoch: 3 cost time: 117.5822103023529
Epoch: 3, Steps: 563 | Train Loss: 0.3952332 Vali Loss: 0.3859408 Test Loss: 0.1473148
Validation loss decreased (0.389978 --> 0.385941).  Saving model ...
Updating learning rate to 0.00045125
	iters: 100, epoch: 4 | loss: 0.8179606
	speed: 1.1162s/iter; left time: 29426.1857s
	iters: 200, epoch: 4 | loss: 0.4249743
	speed: 0.2101s/iter; left time: 5517.3929s
	iters: 300, epoch: 4 | loss: 0.3470764
	speed: 0.2162s/iter; left time: 5656.5495s
	iters: 400, epoch: 4 | loss: 0.7462862
	speed: 0.1949s/iter; left time: 5080.6145s
	iters: 500, epoch: 4 | loss: 0.3964547
	speed: 0.2211s/iter; left time: 5739.8563s
Epoch: 4 cost time: 120.89011740684509
Epoch: 4, Steps: 563 | Train Loss: 0.3921139 Vali Loss: 0.3827438 Test Loss: 0.1461512
Validation loss decreased (0.385941 --> 0.382744).  Saving model ...
Updating learning rate to 0.0004286875
	iters: 100, epoch: 5 | loss: 0.2961631
	speed: 1.2301s/iter; left time: 31735.8992s
	iters: 200, epoch: 5 | loss: 0.8467013
	speed: 0.2172s/iter; left time: 5582.5738s
	iters: 300, epoch: 5 | loss: 0.2720298
	speed: 0.2131s/iter; left time: 5454.3449s
	iters: 400, epoch: 5 | loss: 0.3773732
	speed: 0.2124s/iter; left time: 5415.8958s
	iters: 500, epoch: 5 | loss: 0.8017516
	speed: 0.2062s/iter; left time: 5237.0529s
Epoch: 5 cost time: 123.82568573951721
Epoch: 5, Steps: 563 | Train Loss: 0.3916347 Vali Loss: 0.3828508 Test Loss: 0.1451264
EarlyStopping counter: 1 out of 3
Updating learning rate to 0.00040725312499999993
	iters: 100, epoch: 6 | loss: 0.3575577
	speed: 1.0842s/iter; left time: 27360.5617s
	iters: 200, epoch: 6 | loss: 0.2529195
	speed: 0.1862s/iter; left time: 4680.9694s
	iters: 300, epoch: 6 | loss: 0.2499201
	speed: 0.1860s/iter; left time: 4655.5558s
	iters: 400, epoch: 6 | loss: 0.7416120
	speed: 0.1786s/iter; left time: 4454.1028s
	iters: 500, epoch: 6 | loss: 0.2636848
	speed: 0.1215s/iter; left time: 3016.7420s
Epoch: 6 cost time: 95.46133995056152
Epoch: 6, Steps: 563 | Train Loss: 0.3908151 Vali Loss: 0.3818552 Test Loss: 0.1449623
Validation loss decreased (0.382744 --> 0.381855).  Saving model ...
Updating learning rate to 0.0003868904687499999
	iters: 100, epoch: 7 | loss: 0.6802613
	speed: 0.6252s/iter; left time: 15426.7722s
	iters: 200, epoch: 7 | loss: 0.3699351
	speed: 0.0847s/iter; left time: 2082.1803s
	iters: 300, epoch: 7 | loss: 0.3500245
	speed: 0.0866s/iter; left time: 2118.7657s
	iters: 400, epoch: 7 | loss: 0.3029243
	speed: 0.0833s/iter; left time: 2029.7070s
	iters: 500, epoch: 7 | loss: 1.3045849
	speed: 0.1734s/iter; left time: 4210.0608s
Epoch: 7 cost time: 71.57261943817139
Epoch: 7, Steps: 563 | Train Loss: 0.3900580 Vali Loss: 0.3809717 Test Loss: 0.1444288
Validation loss decreased (0.381855 --> 0.380972).  Saving model ...
Updating learning rate to 0.00036754594531249993
	iters: 100, epoch: 8 | loss: 0.2669387
	speed: 1.0334s/iter; left time: 24914.2205s
	iters: 200, epoch: 8 | loss: 0.3563251
	speed: 0.1956s/iter; left time: 4697.4829s
	iters: 300, epoch: 8 | loss: 0.3007841
	speed: 0.1962s/iter; left time: 4692.3285s
	iters: 400, epoch: 8 | loss: 0.4120661
	speed: 0.1906s/iter; left time: 4537.0998s
	iters: 500, epoch: 8 | loss: 0.3444954
	speed: 0.1951s/iter; left time: 4625.6934s
Epoch: 8 cost time: 111.117600440979
Epoch: 8, Steps: 563 | Train Loss: 0.3893745 Vali Loss: 0.3808283 Test Loss: 0.1444625
Validation loss decreased (0.380972 --> 0.380828).  Saving model ...
Updating learning rate to 0.00034916864804687486
	iters: 100, epoch: 9 | loss: 0.2775987
	speed: 1.0016s/iter; left time: 23585.4817s
	iters: 200, epoch: 9 | loss: 0.2932196
	speed: 0.2169s/iter; left time: 5084.7280s
	iters: 300, epoch: 9 | loss: 0.3393736
	speed: 0.2170s/iter; left time: 5066.4420s
	iters: 400, epoch: 9 | loss: 0.3096036
	speed: 0.2116s/iter; left time: 4920.0455s
	iters: 500, epoch: 9 | loss: 0.8034393
	speed: 0.2147s/iter; left time: 4969.3712s
Epoch: 9 cost time: 120.69360518455505
Epoch: 9, Steps: 563 | Train Loss: 0.3882663 Vali Loss: 0.3782158 Test Loss: 0.1440345
Validation loss decreased (0.380828 --> 0.378216).  Saving model ...
Updating learning rate to 0.00033171021564453113
	iters: 100, epoch: 10 | loss: 0.2810191
	speed: 0.9632s/iter; left time: 22138.8404s
	iters: 200, epoch: 10 | loss: 0.2479003
	speed: 0.1927s/iter; left time: 4409.0022s
	iters: 300, epoch: 10 | loss: 0.2817498
	speed: 0.1891s/iter; left time: 4308.4588s
	iters: 400, epoch: 10 | loss: 0.3791457
	speed: 0.1844s/iter; left time: 4181.9861s
	iters: 500, epoch: 10 | loss: 0.3182850
	speed: 0.1892s/iter; left time: 4272.1677s
Epoch: 10 cost time: 105.47140383720398
Epoch: 10, Steps: 563 | Train Loss: 0.3885147 Vali Loss: 0.3809423 Test Loss: 0.1439951
EarlyStopping counter: 1 out of 3
Updating learning rate to 0.00031512470486230455
	iters: 100, epoch: 11 | loss: 0.3292813
	speed: 0.8053s/iter; left time: 18055.9262s
	iters: 200, epoch: 11 | loss: 0.4064302
	speed: 0.1652s/iter; left time: 3686.7156s
	iters: 300, epoch: 11 | loss: 0.2648570
	speed: 0.1997s/iter; left time: 4437.4501s
	iters: 400, epoch: 11 | loss: 0.2974277
	speed: 0.2280s/iter; left time: 5044.0367s
	iters: 500, epoch: 11 | loss: 0.2993548
	speed: 0.2030s/iter; left time: 4469.1756s
Epoch: 11 cost time: 104.13788604736328
Epoch: 11, Steps: 563 | Train Loss: 0.3883373 Vali Loss: 0.3785949 Test Loss: 0.1440225
EarlyStopping counter: 2 out of 3
Updating learning rate to 0.00029936846961918935
	iters: 100, epoch: 12 | loss: 0.2819631
	speed: 1.0628s/iter; left time: 23229.9308s
	iters: 200, epoch: 12 | loss: 0.8264621
	speed: 0.2055s/iter; left time: 4470.2225s
	iters: 300, epoch: 12 | loss: 1.1943430
	speed: 0.2067s/iter; left time: 4476.8692s
	iters: 400, epoch: 12 | loss: 0.2146198
	speed: 0.2063s/iter; left time: 4448.4138s
	iters: 500, epoch: 12 | loss: 0.3393269
	speed: 0.1833s/iter; left time: 3933.5225s
Epoch: 12 cost time: 114.08342432975769
Epoch: 12, Steps: 563 | Train Loss: 0.3878607 Vali Loss: 0.3779763 Test Loss: 0.1438064
Validation loss decreased (0.378216 --> 0.377976).  Saving model ...
Updating learning rate to 0.0002844000461382298
	iters: 100, epoch: 13 | loss: 0.2435991
	speed: 1.0072s/iter; left time: 21448.3131s
	iters: 200, epoch: 13 | loss: 0.2680771
	speed: 0.1871s/iter; left time: 3965.3046s
	iters: 300, epoch: 13 | loss: 0.8119123
	speed: 0.2210s/iter; left time: 4661.6390s
	iters: 400, epoch: 13 | loss: 0.3637057
	speed: 0.2260s/iter; left time: 4745.0896s
	iters: 500, epoch: 13 | loss: 0.2989635
	speed: 0.2062s/iter; left time: 4308.0567s
Epoch: 13 cost time: 116.50507688522339
Epoch: 13, Steps: 563 | Train Loss: 0.3877448 Vali Loss: 0.3791528 Test Loss: 0.1434824
EarlyStopping counter: 1 out of 3
Updating learning rate to 0.0002701800438313183
	iters: 100, epoch: 14 | loss: 0.4776800
	speed: 1.0229s/iter; left time: 21206.3170s
	iters: 200, epoch: 14 | loss: 0.3204339
	speed: 0.1931s/iter; left time: 3983.5716s
	iters: 300, epoch: 14 | loss: 0.3212831
	speed: 0.1958s/iter; left time: 4019.9647s
	iters: 400, epoch: 14 | loss: 0.2104854
	speed: 0.1964s/iter; left time: 4013.4898s
	iters: 500, epoch: 14 | loss: 0.3593941
	speed: 0.1940s/iter; left time: 3945.1082s
Epoch: 14 cost time: 110.52957248687744
Epoch: 14, Steps: 563 | Train Loss: 0.3875611 Vali Loss: 0.3757139 Test Loss: 0.1433126
Validation loss decreased (0.377976 --> 0.375714).  Saving model ...
Updating learning rate to 0.0002566710416397524
	iters: 100, epoch: 15 | loss: 0.3107946
	speed: 1.0205s/iter; left time: 20582.8915s
	iters: 200, epoch: 15 | loss: 0.2811661
	speed: 0.2005s/iter; left time: 4023.9821s
	iters: 300, epoch: 15 | loss: 0.3762811
	speed: 0.2069s/iter; left time: 4131.2695s
	iters: 400, epoch: 15 | loss: 0.2299710
	speed: 0.2119s/iter; left time: 4210.5209s
	iters: 500, epoch: 15 | loss: 0.2169992
	speed: 0.2116s/iter; left time: 4183.0927s
Epoch: 15 cost time: 116.83401560783386
Epoch: 15, Steps: 563 | Train Loss: 0.3871006 Vali Loss: 0.3785056 Test Loss: 0.1433234
EarlyStopping counter: 1 out of 3
Updating learning rate to 0.00024383748955776477
	iters: 100, epoch: 16 | loss: 0.7792341
	speed: 1.0087s/iter; left time: 19776.9015s
	iters: 200, epoch: 16 | loss: 0.3284850
	speed: 0.1782s/iter; left time: 3476.2007s
	iters: 300, epoch: 16 | loss: 0.2815460
	speed: 0.1771s/iter; left time: 3436.3143s
	iters: 400, epoch: 16 | loss: 0.7365600
	speed: 0.1729s/iter; left time: 3337.2135s
	iters: 500, epoch: 16 | loss: 0.2295105
	speed: 0.1750s/iter; left time: 3360.1990s
Epoch: 16 cost time: 101.8023509979248
Epoch: 16, Steps: 563 | Train Loss: 0.3871681 Vali Loss: 0.3780262 Test Loss: 0.1433813
EarlyStopping counter: 2 out of 3
Updating learning rate to 0.0002316456150798765
	iters: 100, epoch: 17 | loss: 0.7959710
	speed: 0.9113s/iter; left time: 17353.0589s
	iters: 200, epoch: 17 | loss: 0.2276672
	speed: 0.1772s/iter; left time: 3356.9158s
	iters: 300, epoch: 17 | loss: 0.3274222
	speed: 0.1757s/iter; left time: 3310.2740s
	iters: 400, epoch: 17 | loss: 1.2436439
	speed: 0.1866s/iter; left time: 3498.0722s
	iters: 500, epoch: 17 | loss: 0.2524396
	speed: 0.1906s/iter; left time: 3552.4883s
Epoch: 17 cost time: 103.96991777420044
Epoch: 17, Steps: 563 | Train Loss: 0.3869502 Vali Loss: 0.3776342 Test Loss: 0.1432385
EarlyStopping counter: 3 out of 3
Early stopping
>>>>>>>testing : Weather_720_j96_H10_FITS_custom_ftM_sl720_ll48_pl96_H10_0<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 10444
mse:0.1437804400920868, mae:0.1952698528766632, rse:0.4996916949748993, corr:[0.47655    0.47776523 0.47761312 0.4770259  0.47640467 0.47592667
 0.47565708 0.47550106 0.47526783 0.47481987 0.474163   0.4734634
 0.47278434 0.47215948 0.4716231  0.47109538 0.47058737 0.46994728
 0.46923968 0.46844497 0.46771613 0.46710745 0.46665007 0.4661927
 0.46561703 0.46478102 0.46356222 0.46191606 0.46005544 0.45828387
 0.45700008 0.45635018 0.45629537 0.45649153 0.45671332 0.45672283
 0.456528   0.45605946 0.45536074 0.45453432 0.45376268 0.45315707
 0.45267802 0.45221537 0.451677   0.45099127 0.45023993 0.44947898
 0.4486307  0.44789177 0.44738242 0.44701102 0.44679534 0.44658983
 0.44628993 0.445818   0.4452148  0.4445369  0.4438963  0.44337368
 0.44303057 0.4428354  0.4427377  0.44264492 0.4424745  0.4422049
 0.44181898 0.44136968 0.4409288  0.4405249  0.44020575 0.43987185
 0.43956396 0.4392446  0.4388499  0.4384007  0.43794447 0.4375607
 0.4372262  0.43689877 0.43661547 0.43632022 0.43595687 0.43551108
 0.43502316 0.43452567 0.4340878  0.43367827 0.43337095 0.4331096
 0.43287864 0.43261623 0.43226817 0.43191972 0.4317208  0.43155536]

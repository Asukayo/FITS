Args in experiment:
Namespace(H_order=10, ab=2, activation='gelu', aug_data_size=1, aug_method='NA', aug_rate=0.5, base_T=144, batch_size=256, c_out=7, checkpoints='./checkpoints/', cut_freq=70, d_ff=2048, d_layers=1, d_model=512, data='custom', data_path='weather.csv', data_size=1, dec_in=7, des='Exp', devices='0,1,2,3', distil=True, do_predict=False, dropout=0.05, e_layers=2, embed='timeF', embed_type=0, enc_in=21, factor=1, features='M', freq='h', gpu=3, groups=1, hidden_size=1, in_batch_augmentation=False, in_dataset_augmentation=False, individual=True, is_training=1, itr=1, kernel=5, label_len=48, learning_rate=0.0005, levels=3, loss='mse', lradj='type3', model='FITS', model_id='Weather_720_j96_H10', moving_avg=25, n_heads=8, num_workers=10, output_attention=False, patience=3, pred_len=96, root_path='./dataset/', seed=2021, seq_len=720, stacks=1, target='OT', test_flop=False, test_time_train=False, testset_div=2, train_epochs=50, train_mode=2, use_amp=False, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:3
>>>>>>>start training : Weather_720_j96_H10_FITS_custom_ftM_sl720_ll48_pl96_H10_0>>>>>>>>>>>>>>>>>>>>>>>>>>
train 36072
val 5175
test 10444
Model(
  (freq_upsampler): ModuleList(
    (0): Linear(in_features=70, out_features=79, bias=True)
    (1): Linear(in_features=70, out_features=79, bias=True)
    (2): Linear(in_features=70, out_features=79, bias=True)
    (3): Linear(in_features=70, out_features=79, bias=True)
    (4): Linear(in_features=70, out_features=79, bias=True)
    (5): Linear(in_features=70, out_features=79, bias=True)
    (6): Linear(in_features=70, out_features=79, bias=True)
    (7): Linear(in_features=70, out_features=79, bias=True)
    (8): Linear(in_features=70, out_features=79, bias=True)
    (9): Linear(in_features=70, out_features=79, bias=True)
    (10): Linear(in_features=70, out_features=79, bias=True)
    (11): Linear(in_features=70, out_features=79, bias=True)
    (12): Linear(in_features=70, out_features=79, bias=True)
    (13): Linear(in_features=70, out_features=79, bias=True)
    (14): Linear(in_features=70, out_features=79, bias=True)
    (15): Linear(in_features=70, out_features=79, bias=True)
    (16): Linear(in_features=70, out_features=79, bias=True)
    (17): Linear(in_features=70, out_features=79, bias=True)
    (18): Linear(in_features=70, out_features=79, bias=True)
    (19): Linear(in_features=70, out_features=79, bias=True)
    (20): Linear(in_features=70, out_features=79, bias=True)
  )
)
[INFO] Register count_linear() for <class 'torch.nn.modules.linear.Linear'>.
FLOPs:  29729280.0
params:  117789.0
Trainable parameters:  117789
!!!!!!!!!!!!!!learning rate!!!!!!!!!!!!!!!
0.0005
	iters: 100, epoch: 1 | loss: 0.5355128
	speed: 0.1932s/iter; left time: 1333.3192s
Epoch: 1 cost time: 26.50641131401062
Epoch: 1, Steps: 140 | Train Loss: 0.6207698 Vali Loss: 0.5934809 Test Loss: 0.2381023
Validation loss decreased (inf --> 0.593481).  Saving model ...
Updating learning rate to 0.0005
	iters: 100, epoch: 2 | loss: 0.4124530
	speed: 0.4319s/iter; left time: 2919.9634s
Epoch: 2 cost time: 25.925604820251465
Epoch: 2, Steps: 140 | Train Loss: 0.4429453 Vali Loss: 0.5281328 Test Loss: 0.2114743
Validation loss decreased (0.593481 --> 0.528133).  Saving model ...
Updating learning rate to 0.000475
	iters: 100, epoch: 3 | loss: 0.3608405
	speed: 0.4196s/iter; left time: 2778.2543s
Epoch: 3 cost time: 25.868705987930298
Epoch: 3, Steps: 140 | Train Loss: 0.3592614 Vali Loss: 0.5066412 Test Loss: 0.2011937
Validation loss decreased (0.528133 --> 0.506641).  Saving model ...
Updating learning rate to 0.00045125
	iters: 100, epoch: 4 | loss: 0.3138818
	speed: 0.4169s/iter; left time: 2701.6927s
Epoch: 4 cost time: 24.451770305633545
Epoch: 4, Steps: 140 | Train Loss: 0.3073764 Vali Loss: 0.4923038 Test Loss: 0.1938887
Validation loss decreased (0.506641 --> 0.492304).  Saving model ...
Updating learning rate to 0.0004286875
	iters: 100, epoch: 5 | loss: 0.2351970
	speed: 0.4232s/iter; left time: 2683.3271s
Epoch: 5 cost time: 25.38917350769043
Epoch: 5, Steps: 140 | Train Loss: 0.2707609 Vali Loss: 0.4793889 Test Loss: 0.1879005
Validation loss decreased (0.492304 --> 0.479389).  Saving model ...
Updating learning rate to 0.00040725312499999993
	iters: 100, epoch: 6 | loss: 0.2435548
	speed: 0.4345s/iter; left time: 2694.4794s
Epoch: 6 cost time: 26.200257778167725
Epoch: 6, Steps: 140 | Train Loss: 0.2436941 Vali Loss: 0.4696394 Test Loss: 0.1827087
Validation loss decreased (0.479389 --> 0.469639).  Saving model ...
Updating learning rate to 0.0003868904687499999
	iters: 100, epoch: 7 | loss: 0.2168414
	speed: 0.4256s/iter; left time: 2579.3445s
Epoch: 7 cost time: 24.369160413742065
Epoch: 7, Steps: 140 | Train Loss: 0.2227930 Vali Loss: 0.4586791 Test Loss: 0.1784267
Validation loss decreased (0.469639 --> 0.458679).  Saving model ...
Updating learning rate to 0.00036754594531249993
	iters: 100, epoch: 8 | loss: 0.2115453
	speed: 0.4187s/iter; left time: 2479.3794s
Epoch: 8 cost time: 25.589637756347656
Epoch: 8, Steps: 140 | Train Loss: 0.2065160 Vali Loss: 0.4509825 Test Loss: 0.1748044
Validation loss decreased (0.458679 --> 0.450983).  Saving model ...
Updating learning rate to 0.00034916864804687486
	iters: 100, epoch: 9 | loss: 0.1927867
	speed: 0.4789s/iter; left time: 2768.6614s
Epoch: 9 cost time: 28.291856288909912
Epoch: 9, Steps: 140 | Train Loss: 0.1939183 Vali Loss: 0.4426360 Test Loss: 0.1715260
Validation loss decreased (0.450983 --> 0.442636).  Saving model ...
Updating learning rate to 0.00033171021564453113
	iters: 100, epoch: 10 | loss: 0.2283126
	speed: 0.4625s/iter; left time: 2609.1327s
Epoch: 10 cost time: 28.542001485824585
Epoch: 10, Steps: 140 | Train Loss: 0.1838850 Vali Loss: 0.4377084 Test Loss: 0.1688686
Validation loss decreased (0.442636 --> 0.437708).  Saving model ...
Updating learning rate to 0.00031512470486230455
	iters: 100, epoch: 11 | loss: 0.1944741
	speed: 0.4700s/iter; left time: 2585.2308s
Epoch: 11 cost time: 28.88777184486389
Epoch: 11, Steps: 140 | Train Loss: 0.1754729 Vali Loss: 0.4268148 Test Loss: 0.1664899
Validation loss decreased (0.437708 --> 0.426815).  Saving model ...
Updating learning rate to 0.00029936846961918935
	iters: 100, epoch: 12 | loss: 0.1580413
	speed: 0.4999s/iter; left time: 2680.0777s
Epoch: 12 cost time: 31.870193004608154
Epoch: 12, Steps: 140 | Train Loss: 0.1691728 Vali Loss: 0.4277145 Test Loss: 0.1646413
EarlyStopping counter: 1 out of 3
Updating learning rate to 0.0002844000461382298
	iters: 100, epoch: 13 | loss: 0.1810129
	speed: 0.5158s/iter; left time: 2693.1079s
Epoch: 13 cost time: 31.114699602127075
Epoch: 13, Steps: 140 | Train Loss: 0.1640279 Vali Loss: 0.4205757 Test Loss: 0.1628726
Validation loss decreased (0.426815 --> 0.420576).  Saving model ...
Updating learning rate to 0.0002701800438313183
	iters: 100, epoch: 14 | loss: 0.1396120
	speed: 0.5212s/iter; left time: 2648.2555s
Epoch: 14 cost time: 30.304049968719482
Epoch: 14, Steps: 140 | Train Loss: 0.1597573 Vali Loss: 0.4178079 Test Loss: 0.1613949
Validation loss decreased (0.420576 --> 0.417808).  Saving model ...
Updating learning rate to 0.0002566710416397524
	iters: 100, epoch: 15 | loss: 0.1701685
	speed: 0.4985s/iter; left time: 2462.9697s
Epoch: 15 cost time: 30.60075283050537
Epoch: 15, Steps: 140 | Train Loss: 0.1559281 Vali Loss: 0.4142028 Test Loss: 0.1601326
Validation loss decreased (0.417808 --> 0.414203).  Saving model ...
Updating learning rate to 0.00024383748955776477
	iters: 100, epoch: 16 | loss: 0.1822086
	speed: 0.4940s/iter; left time: 2371.8786s
Epoch: 16 cost time: 30.696805953979492
Epoch: 16, Steps: 140 | Train Loss: 0.1534791 Vali Loss: 0.4126123 Test Loss: 0.1590402
Validation loss decreased (0.414203 --> 0.412612).  Saving model ...
Updating learning rate to 0.0002316456150798765
	iters: 100, epoch: 17 | loss: 0.1534441
	speed: 0.5400s/iter; left time: 2516.7614s
Epoch: 17 cost time: 33.6436550617218
Epoch: 17, Steps: 140 | Train Loss: 0.1508850 Vali Loss: 0.4102274 Test Loss: 0.1581507
Validation loss decreased (0.412612 --> 0.410227).  Saving model ...
Updating learning rate to 0.00022006333432588268
	iters: 100, epoch: 18 | loss: 0.1601830
	speed: 0.5464s/iter; left time: 2470.4621s
Epoch: 18 cost time: 33.92045760154724
Epoch: 18, Steps: 140 | Train Loss: 0.1491029 Vali Loss: 0.4058761 Test Loss: 0.1574275
Validation loss decreased (0.410227 --> 0.405876).  Saving model ...
Updating learning rate to 0.00020906016760958854
	iters: 100, epoch: 19 | loss: 0.1613082
	speed: 0.5669s/iter; left time: 2483.6704s
Epoch: 19 cost time: 32.32494854927063
Epoch: 19, Steps: 140 | Train Loss: 0.1476009 Vali Loss: 0.4045088 Test Loss: 0.1566224
Validation loss decreased (0.405876 --> 0.404509).  Saving model ...
Updating learning rate to 0.0001986071592291091
	iters: 100, epoch: 20 | loss: 0.1400168
	speed: 0.5431s/iter; left time: 2303.4960s
Epoch: 20 cost time: 33.478583097457886
Epoch: 20, Steps: 140 | Train Loss: 0.1460303 Vali Loss: 0.4042075 Test Loss: 0.1559520
Validation loss decreased (0.404509 --> 0.404208).  Saving model ...
Updating learning rate to 0.00018867680126765363
	iters: 100, epoch: 21 | loss: 0.1240110
	speed: 0.5356s/iter; left time: 2196.5309s
Epoch: 21 cost time: 31.657548666000366
Epoch: 21, Steps: 140 | Train Loss: 0.1449842 Vali Loss: 0.4044448 Test Loss: 0.1555515
EarlyStopping counter: 1 out of 3
Updating learning rate to 0.00017924296120427094
	iters: 100, epoch: 22 | loss: 0.1443965
	speed: 0.5053s/iter; left time: 2001.3933s
Epoch: 22 cost time: 30.794551610946655
Epoch: 22, Steps: 140 | Train Loss: 0.1444121 Vali Loss: 0.4040828 Test Loss: 0.1551353
Validation loss decreased (0.404208 --> 0.404083).  Saving model ...
Updating learning rate to 0.0001702808131440574
	iters: 100, epoch: 23 | loss: 0.1545481
	speed: 0.4937s/iter; left time: 1886.6004s
Epoch: 23 cost time: 32.019688844680786
Epoch: 23, Steps: 140 | Train Loss: 0.1435925 Vali Loss: 0.4005311 Test Loss: 0.1547483
Validation loss decreased (0.404083 --> 0.400531).  Saving model ...
Updating learning rate to 0.0001617667724868545
	iters: 100, epoch: 24 | loss: 0.1443940
	speed: 0.5119s/iter; left time: 1884.2113s
Epoch: 24 cost time: 30.756665468215942
Epoch: 24, Steps: 140 | Train Loss: 0.1429211 Vali Loss: 0.4004740 Test Loss: 0.1542579
Validation loss decreased (0.400531 --> 0.400474).  Saving model ...
Updating learning rate to 0.00015367843386251178
	iters: 100, epoch: 25 | loss: 0.1447346
	speed: 0.5314s/iter; left time: 1881.8308s
Epoch: 25 cost time: 33.02595806121826
Epoch: 25, Steps: 140 | Train Loss: 0.1423133 Vali Loss: 0.4005138 Test Loss: 0.1540245
EarlyStopping counter: 1 out of 3
Updating learning rate to 0.0001459945121693862
	iters: 100, epoch: 26 | loss: 0.1621657
	speed: 0.5465s/iter; left time: 1858.5487s
Epoch: 26 cost time: 34.06263303756714
Epoch: 26, Steps: 140 | Train Loss: 0.1418164 Vali Loss: 0.3987646 Test Loss: 0.1538702
Validation loss decreased (0.400474 --> 0.398765).  Saving model ...
Updating learning rate to 0.00013869478656091687
	iters: 100, epoch: 27 | loss: 0.1354962
	speed: 0.5624s/iter; left time: 1834.0982s
Epoch: 27 cost time: 32.87885403633118
Epoch: 27, Steps: 140 | Train Loss: 0.1413393 Vali Loss: 0.3985127 Test Loss: 0.1536533
Validation loss decreased (0.398765 --> 0.398513).  Saving model ...
Updating learning rate to 0.00013176004723287101
	iters: 100, epoch: 28 | loss: 0.1353427
	speed: 0.5085s/iter; left time: 1586.8967s
Epoch: 28 cost time: 30.497735261917114
Epoch: 28, Steps: 140 | Train Loss: 0.1413812 Vali Loss: 0.3977358 Test Loss: 0.1533906
Validation loss decreased (0.398513 --> 0.397736).  Saving model ...
Updating learning rate to 0.00012517204487122748
	iters: 100, epoch: 29 | loss: 0.1567874
	speed: 0.4784s/iter; left time: 1426.0059s
Epoch: 29 cost time: 26.279270887374878
Epoch: 29, Steps: 140 | Train Loss: 0.1412090 Vali Loss: 0.3979005 Test Loss: 0.1531390
EarlyStopping counter: 1 out of 3
Updating learning rate to 0.00011891344262766608
	iters: 100, epoch: 30 | loss: 0.0994146
	speed: 0.3935s/iter; left time: 1117.8296s
Epoch: 30 cost time: 27.31154227256775
Epoch: 30, Steps: 140 | Train Loss: 0.1408079 Vali Loss: 0.3969876 Test Loss: 0.1531106
Validation loss decreased (0.397736 --> 0.396988).  Saving model ...
Updating learning rate to 0.00011296777049628277
	iters: 100, epoch: 31 | loss: 0.0951982
	speed: 0.4503s/iter; left time: 1216.2005s
Epoch: 31 cost time: 26.307433605194092
Epoch: 31, Steps: 140 | Train Loss: 0.1403257 Vali Loss: 0.3948391 Test Loss: 0.1529645
Validation loss decreased (0.396988 --> 0.394839).  Saving model ...
Updating learning rate to 0.00010731938197146864
	iters: 100, epoch: 32 | loss: 0.1203242
	speed: 0.4219s/iter; left time: 1080.3666s
Epoch: 32 cost time: 25.780959129333496
Epoch: 32, Steps: 140 | Train Loss: 0.1403037 Vali Loss: 0.3979000 Test Loss: 0.1528248
EarlyStopping counter: 1 out of 3
Updating learning rate to 0.00010195341287289519
	iters: 100, epoch: 33 | loss: 0.1311860
	speed: 0.4129s/iter; left time: 999.5943s
Epoch: 33 cost time: 24.461434841156006
Epoch: 33, Steps: 140 | Train Loss: 0.1403696 Vali Loss: 0.3940568 Test Loss: 0.1526763
Validation loss decreased (0.394839 --> 0.394057).  Saving model ...
Updating learning rate to 9.685574222925044e-05
	iters: 100, epoch: 34 | loss: 0.1564685
	speed: 0.4061s/iter; left time: 926.3728s
Epoch: 34 cost time: 24.790319681167603
Epoch: 34, Steps: 140 | Train Loss: 0.1403020 Vali Loss: 0.3960111 Test Loss: 0.1525708
EarlyStopping counter: 1 out of 3
Updating learning rate to 9.201295511778792e-05
	iters: 100, epoch: 35 | loss: 0.1788060
	speed: 0.3632s/iter; left time: 777.6529s
Epoch: 35 cost time: 23.455386877059937
Epoch: 35, Steps: 140 | Train Loss: 0.1398417 Vali Loss: 0.3961404 Test Loss: 0.1525133
EarlyStopping counter: 2 out of 3
Updating learning rate to 8.74123073618985e-05
	iters: 100, epoch: 36 | loss: 0.1622661
	speed: 0.3853s/iter; left time: 770.9879s
Epoch: 36 cost time: 25.05238652229309
Epoch: 36, Steps: 140 | Train Loss: 0.1400410 Vali Loss: 0.3964132 Test Loss: 0.1524367
EarlyStopping counter: 3 out of 3
Early stopping
train 36072
val 5175
test 10444
Model(
  (freq_upsampler): ModuleList(
    (0): Linear(in_features=70, out_features=79, bias=True)
    (1): Linear(in_features=70, out_features=79, bias=True)
    (2): Linear(in_features=70, out_features=79, bias=True)
    (3): Linear(in_features=70, out_features=79, bias=True)
    (4): Linear(in_features=70, out_features=79, bias=True)
    (5): Linear(in_features=70, out_features=79, bias=True)
    (6): Linear(in_features=70, out_features=79, bias=True)
    (7): Linear(in_features=70, out_features=79, bias=True)
    (8): Linear(in_features=70, out_features=79, bias=True)
    (9): Linear(in_features=70, out_features=79, bias=True)
    (10): Linear(in_features=70, out_features=79, bias=True)
    (11): Linear(in_features=70, out_features=79, bias=True)
    (12): Linear(in_features=70, out_features=79, bias=True)
    (13): Linear(in_features=70, out_features=79, bias=True)
    (14): Linear(in_features=70, out_features=79, bias=True)
    (15): Linear(in_features=70, out_features=79, bias=True)
    (16): Linear(in_features=70, out_features=79, bias=True)
    (17): Linear(in_features=70, out_features=79, bias=True)
    (18): Linear(in_features=70, out_features=79, bias=True)
    (19): Linear(in_features=70, out_features=79, bias=True)
    (20): Linear(in_features=70, out_features=79, bias=True)
  )
)
[INFO] Register count_linear() for <class 'torch.nn.modules.linear.Linear'>.
FLOPs:  29729280.0
params:  117789.0
Trainable parameters:  117789
!!!!!!!!!!!!!!learning rate!!!!!!!!!!!!!!!
0.0005
	iters: 100, epoch: 1 | loss: 0.5650829
	speed: 0.1613s/iter; left time: 1113.3571s
Epoch: 1 cost time: 22.859484434127808
Epoch: 1, Steps: 140 | Train Loss: 0.3988884 Vali Loss: 0.3838006 Test Loss: 0.1472638
Validation loss decreased (inf --> 0.383801).  Saving model ...
Updating learning rate to 0.0005
	iters: 100, epoch: 2 | loss: 0.5234449
	speed: 0.3877s/iter; left time: 2621.2867s
Epoch: 2 cost time: 23.842667818069458
Epoch: 2, Steps: 140 | Train Loss: 0.3921496 Vali Loss: 0.3815859 Test Loss: 0.1458762
Validation loss decreased (0.383801 --> 0.381586).  Saving model ...
Updating learning rate to 0.000475
	iters: 100, epoch: 3 | loss: 0.4201081
	speed: 0.4111s/iter; left time: 2721.6755s
Epoch: 3 cost time: 22.96916699409485
Epoch: 3, Steps: 140 | Train Loss: 0.3924017 Vali Loss: 0.3827328 Test Loss: 0.1455174
EarlyStopping counter: 1 out of 3
Updating learning rate to 0.00045125
	iters: 100, epoch: 4 | loss: 0.4849595
	speed: 0.3923s/iter; left time: 2542.4859s
Epoch: 4 cost time: 23.3476881980896
Epoch: 4, Steps: 140 | Train Loss: 0.3910854 Vali Loss: 0.3793554 Test Loss: 0.1450194
Validation loss decreased (0.381586 --> 0.379355).  Saving model ...
Updating learning rate to 0.0004286875
	iters: 100, epoch: 5 | loss: 0.5079033
	speed: 0.4069s/iter; left time: 2579.9377s
Epoch: 5 cost time: 22.932161331176758
Epoch: 5, Steps: 140 | Train Loss: 0.3905391 Vali Loss: 0.3807589 Test Loss: 0.1448933
EarlyStopping counter: 1 out of 3
Updating learning rate to 0.00040725312499999993
	iters: 100, epoch: 6 | loss: 0.3430855
	speed: 0.3987s/iter; left time: 2472.2882s
Epoch: 6 cost time: 25.342866897583008
Epoch: 6, Steps: 140 | Train Loss: 0.3897787 Vali Loss: 0.3810459 Test Loss: 0.1444560
EarlyStopping counter: 2 out of 3
Updating learning rate to 0.0003868904687499999
	iters: 100, epoch: 7 | loss: 0.3843700
	speed: 0.4148s/iter; left time: 2514.0977s
Epoch: 7 cost time: 25.127304553985596
Epoch: 7, Steps: 140 | Train Loss: 0.3893090 Vali Loss: 0.3810334 Test Loss: 0.1442336
EarlyStopping counter: 3 out of 3
Early stopping
>>>>>>>testing : Weather_720_j96_H10_FITS_custom_ftM_sl720_ll48_pl96_H10_0<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 10444
mse:0.14553311467170715, mae:0.19858452677726746, rse:0.5027281045913696, corr:[0.4645535  0.47320303 0.47716892 0.47760376 0.47605753 0.47388527
 0.47214946 0.4713849  0.47160292 0.47236252 0.47310454 0.4734507
 0.47322303 0.47252432 0.47162506 0.4707583  0.47012636 0.46964374
 0.4692694  0.46879408 0.468161   0.46732017 0.46635017 0.46524683
 0.46411285 0.46302173 0.46201468 0.46105632 0.46021524 0.45945036
 0.45875713 0.45811552 0.457602   0.45716983 0.45686972 0.45659992
 0.45640156 0.45614997 0.45577568 0.45525205 0.45464876 0.45405647
 0.4535052  0.4529848  0.4524714  0.4519068  0.451344   0.45077002
 0.4500208  0.449216   0.44844022 0.44764307 0.4469825  0.44646943
 0.44610557 0.44581142 0.44553337 0.44516772 0.44469622 0.44410548
 0.44344634 0.44276333 0.4422025  0.44184738 0.44171634 0.44178653
 0.44190547 0.44196722 0.44187152 0.44153723 0.4410019  0.44020194
 0.43937895 0.4386984  0.43821537 0.43797615 0.43793142 0.4380353
 0.43811262 0.43802086 0.43778533 0.4373411  0.4367271  0.43616474
 0.43587235 0.4358866  0.43612528 0.43629563 0.43636063 0.43614307
 0.4357092  0.43514973 0.43454093 0.43414438 0.43408316 0.43401152]
